!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):e.VirtualList=t(e.React,e.PropTypes)}(this,function(z,o){"use strict";var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};var I=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e};var e,t,n,u="start",c="center",v="vertical",r="horizontal",d="requested",s=((e={})[v]="scrollTop",e[r]="scrollLeft",e),y=((t={})[v]="height",t[r]="width",t),f=((n={})[v]="top",n[r]="left",n),a=function(){function e(e){var t=e.itemCount,o=e.itemSizeGetter,i=e.estimatedItemSize;this.itemSizeGetter=o,this.itemCount=t,this.estimatedItemSize=i,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1}return e.prototype.updateConfig=function(e){var t=e.itemCount,o=e.estimatedItemSize;this.itemCount=t,this.estimatedItemSize=o},e.prototype.getLastMeasuredIndex=function(){return this.lastMeasuredIndex},e.prototype.getSizeAndPositionForIndex=function(e){if(e<0||e>=this.itemCount)throw Error("Requested index "+e+" is outside of range 0.."+this.itemCount);if(e>this.lastMeasuredIndex){for(var t=this.getSizeAndPositionOfLastMeasuredItem(),o=t.offset+t.size,i=this.lastMeasuredIndex+1;i<=e;i++){var n=this.itemSizeGetter(i);if(null==n||isNaN(n))throw Error("Invalid size returned for index "+i+" of value "+n);this.itemSizeAndPositionData[i]={offset:o,size:n},o+=n}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]},e.prototype.getSizeAndPositionOfLastMeasuredItem=function(){return 0<=this.lastMeasuredIndex?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}},e.prototype.getTotalSize=function(){var e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize},e.prototype.getUpdatedOffsetForIndex=function(e){var t=e.align,o=void 0===t?u:t,i=e.containerSize,n=e.currentOffset,r=e.targetIndex;if(i<=0)return 0;var s,a=this.getSizeAndPositionForIndex(r),f=a.offset,l=f-i+a.size;switch(o){case"end":s=l;break;case c:s=f-(i-a.size)/2;break;case u:s=f;break;default:s=Math.max(l,Math.min(f,n))}var d=this.getTotalSize();return Math.max(0,Math.min(d-i,s))},e.prototype.getVisibleRange=function(e){var t=e.containerSize,o=e.offset,i=e.overscanCount;if(0===this.getTotalSize())return{};var n=o+t,r=this.findNearestItem(o);if(void 0===r)throw Error("Invalid offset "+o+" specified");var s=this.getSizeAndPositionForIndex(r);o=s.offset+s.size;for(var a=r;o<n&&a<this.itemCount-1;)a++,o+=this.getSizeAndPositionForIndex(a).size;return i&&(r=Math.max(0,r-i),a=Math.min(a+i,this.itemCount-1)),{start:r,stop:a}},e.prototype.resetItem=function(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)},e.prototype.findNearestItem=function(e){if(isNaN(e))throw Error("Invalid offset "+e+" specified");e=Math.max(0,e);var t=this.getSizeAndPositionOfLastMeasuredItem(),o=Math.max(0,this.lastMeasuredIndex);return t.offset>=e?this.binarySearch({high:o,low:0,offset:e}):this.exponentialSearch({index:o,offset:e})},e.prototype.binarySearch=function(e){for(var t=e.low,o=e.high,i=e.offset,n=0,r=0;t<=o;){if(n=t+Math.floor((o-t)/2),(r=this.getSizeAndPositionForIndex(n).offset)===i)return n;r<i?t=n+1:i<r&&(o=n-1)}return 0<t?t-1:0},e.prototype.exponentialSearch=function(e){for(var t=e.index,o=e.offset,i=1;t<this.itemCount&&this.getSizeAndPositionForIndex(t).offset<o;)t+=i,i*=2;return this.binarySearch({high:Math.min(t,this.itemCount-1),low:Math.floor(t/2),offset:o})},e}(),x={overflow:"scroll",willChange:"transform",WebkitOverflowScrolling:"touch"},O={position:"relative",overflow:"visible",width:"100%",minHeight:"100%"},l={position:"absolute",left:0,width:"100%"};return function(e){function t(){var i=null!==e&&e.apply(this,arguments)||this;return i.sizeAndPositionManager=new a({itemCount:i.props.itemCount,itemSizeGetter:function(e){return i.getSize(e)},estimatedItemSize:i.getEstimatedItemSize()}),i.state={offset:i.props.scrollOffset||null!=i.props.scrollToIndex&&i.getOffsetForIndex(i.props.scrollToIndex)||0,scrollChangeReason:d},i.styleCache={},i.handleScroll=function(e){var t=i.props.onScroll,o=i.getNodeOffset();o<0||i.state.offset===o||e.target!==i.rootNode||(i.setState({offset:o,scrollChangeReason:"observed"}),"function"==typeof t&&t(o,e))},i.getRef=function(e){i.rootNode=e},i}return function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.scrollOffset,o=e.scrollToIndex;null!=t?this.scrollTo(t):null!=o&&this.scrollTo(this.getOffsetForIndex(o))},t.prototype.componentWillReceiveProps=function(e){var t=this.props,o=t.estimatedItemSize,i=t.itemCount,n=t.itemSize,r=t.scrollOffset,s=t.scrollToAlignment,a=t.scrollToIndex,f=e.scrollToIndex!==a||e.scrollToAlignment!==s,l=e.itemCount!==i||e.itemSize!==n||e.estimatedItemSize!==o;e.itemCount===i&&e.estimatedItemSize===o||this.sizeAndPositionManager.updateConfig({itemCount:e.itemCount,estimatedItemSize:this.getEstimatedItemSize(e)}),l&&this.recomputeSizes(),e.scrollOffset!==r?this.setState({offset:e.scrollOffset||0,scrollChangeReason:d}):"number"==typeof e.scrollToIndex&&(f||l)&&this.setState({offset:this.getOffsetForIndex(e.scrollToIndex,e.scrollToAlignment,e.itemCount),scrollChangeReason:d})},t.prototype.componentDidUpdate=function(e,t){var o=this.state,i=o.offset,n=o.scrollChangeReason;t.offset!==i&&n===d&&this.scrollTo(i)},t.prototype.getEstimatedItemSize=function(e){return void 0===e&&(e=this.props),e.estimatedItemSize||"number"==typeof e.itemSize&&e.itemSize||50},t.prototype.getNodeOffset=function(){var e=this.props.scrollDirection,t=void 0===e?v:e;return this.rootNode[s[t]]},t.prototype.scrollTo=function(e){var t=this.props.scrollDirection,o=void 0===t?v:t;this.rootNode[s[o]]=e},t.prototype.getOffsetForIndex=function(e,t,o){void 0===t&&(t=this.props.scrollToAlignment),void 0===o&&(o=this.props.itemCount);var i=this.props.scrollDirection,n=void 0===i?v:i;return(e<0||o<=e)&&(e=0),this.sizeAndPositionManager.getUpdatedOffsetForIndex({align:t,containerSize:this.props[y[n]],currentOffset:this.state&&this.state.offset||0,targetIndex:e})},t.prototype.getSize=function(e){var t=this.props.itemSize;return"function"==typeof t?t(e):Array.isArray(t)?t[e]:t},t.prototype.getStyle=function(e){var t=this.styleCache[e];if(t)return t;var o,i=this.props.scrollDirection,n=void 0===i?v:i,r=this.sizeAndPositionManager.getSizeAndPositionForIndex(e),s=r.size,a=r.offset;return this.styleCache[e]=I({},l,((o={})[y[n]]=s,o[f[n]]=a,o))},t.prototype.recomputeSizes=function(e){void 0===e&&(e=0),this.styleCache={},this.sizeAndPositionManager.resetItem(e)},t.prototype.render=function(){var e,t=this.props,o=(t.estimatedItemSize,t.height),i=t.overscanCount,n=void 0===i?3:i,r=t.renderItem,s=(t.itemCount,t.itemSize,t.onItemsRendered),a=(t.onScroll,t.scrollDirection),f=void 0===a?v:a,l=(t.scrollOffset,t.scrollToIndex,t.scrollToAlignment,t.style),d=t.width,u=function(e,t){var o={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(o[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&(o[i[n]]=e[i[n]])}return o}(t,["estimatedItemSize","height","overscanCount","renderItem","itemCount","itemSize","onItemsRendered","onScroll","scrollDirection","scrollOffset","scrollToIndex","scrollToAlignment","style","width"]),c=this.state.offset,h=this.sizeAndPositionManager.getVisibleRange({containerSize:this.props[y[f]]||0,offset:c,overscanCount:n}),p=h.start,m=h.stop,g=[];if(void 0!==p&&void 0!==m){for(var S=p;S<=m;S++)g.push(r({index:S,style:this.getStyle(S)}));"function"==typeof s&&s({startIndex:p,stopIndex:m})}return z.createElement("div",I({ref:this.getRef},u,{onScroll:this.handleScroll,style:I({},x,l,{height:o,width:d})}),z.createElement("div",{style:I({},O,(e={},e[y[f]]=this.sizeAndPositionManager.getTotalSize(),e))},g))},t.defaultProps={overscanCount:3,scrollDirection:v,width:"100%"},t.propTypes={estimatedItemSize:o.number,height:o.oneOfType([o.number,o.string]).isRequired,itemCount:o.number.isRequired,itemSize:o.oneOfType([o.number,o.array,o.func]).isRequired,onItemsRendered:o.func,overscanCount:o.number,renderItem:o.func.isRequired,scrollOffset:o.number,scrollToIndex:o.number,scrollToAlignment:o.oneOf(["auto",u,c,"end"]),scrollDirection:o.oneOf([r,v]).isRequired,width:o.oneOfType([o.number,o.string]).isRequired},t}(z.PureComponent)});
